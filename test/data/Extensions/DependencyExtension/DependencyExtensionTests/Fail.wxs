<?xml version="1.0" encoding="UTF-8"?>
<!--
    Copyright (c) Microsoft Corporation. All rights reserved.
-->

<?ifndef Version?>
<?define Version = 1.0.0.0?>
<?endif?>

<?ifndef TestName?>
<?define TestName = Test?>
<?endif?>

<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:dep="http://schemas.microsoft.com/wix/DependencyExtension">
    <Product Id="*" Name="$(var.TestName) - Fail" Language="1033" Version="$(var.Version)" Manufacturer="Microsoft Corporation" UpgradeCode="3979D95E-DBE9-4142-A21B-CD9BC9AB8AE9">
        <Package Description="Product Fail in test $(var.TestName)" Comments="Test from: wix\test\data\Extensions\DependencyExtension\DependencyExtensionTests\Fail.wxs" Compressed="yes" InstallerVersion="300" InstallScope="perMachine"/>
        <Media Id="1" Cabinet="product.cab" EmbedCab="yes"/>
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="ProgramFilesFolder" Name="Program Files">
                <Directory Id="WixDir" Name="WiX">
                    <Directory Id="TestDir" Name="$(var.TestName)">
                        <Directory Id="INSTALLDIR" Name="Fail"/>
                    </Directory>
                </Directory>
            </Directory>
        </Directory>
        <Feature Id="Complete" Level="1">
            <ComponentRef Id="Main"/>
        </Feature>
        <Property Id="MsiLogging" Value="voicewarmup"/>
        <Upgrade Id="3979D95E-DBE9-4142-A21B-CD9BC9AB8AE9">
            <UpgradeVersion Maximum="$(var.Version)" MigrateFeatures="yes" Property="OLDERVERSIONS"/>
            <UpgradeVersion Minimum="$(var.Version)" OnlyDetect="yes" Property="NEWERVERSIONS"/>
        </Upgrade>
        <InstallExecuteSequence>
            <Custom Action="FailCA" Before="InstallFinalize"/>
            <RemoveExistingProducts After="InstallInitialize"/>
        </InstallExecuteSequence>
        <CustomAction Id="FailCA" Error="Failed."/>
    </Product>
    <Fragment>
        <DirectoryRef Id="INSTALLDIR">
            <Component Id="Main" Guid="1560E1BB-E58E-4703-A83C-0F3F296260CA">
                <File Source="$(sys.SOURCEFILEPATH)"/>
                <dep:Provides Key="Microsoft.WiX.$(var.TestName).Fail,v1.0"/>
            </Component>
        </DirectoryRef>
    </Fragment>
</Wix>
